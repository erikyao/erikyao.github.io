
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Erik Yao's 内部类：对外部类的访问及 .this 和 .new</title>
    <meta name="description" content="">
    <meta name="author" content="Erik Yao">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/css/1.4.0/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
	<link href="/assets/themes/twitter/google-code-prettify/prettify.css" rel="stylesheet" type="text/css" media="all">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/prettify.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/use-prettify.js"></script>
  </head>

  <body>

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="/">Erik Yao's</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/index.html">Home</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>内部类：对外部类的访问及 .this 和 .new <small></small></h1>
</div>

<div class="row">
  <div class="span10">
    

<pre class="prettyprint linenums">
class Outer {   
    public class Inner {   
        public String getInnerClassName() {   
            return Inner.this.getClass().toString(); // 'Inner' can be omitted here   
        }  
          
        public String getOuterClassName() {   
            return Outer.this.getClass().toString(); // 'Outer' CANNOT be omitted here   
        }   
    }   
      
    public Inner createInner() {   
        return new Inner(); 
        // return this.new Inner(); // also OK here   
    }   
}   
  
public class InnerTest {   
    public static void main(String[] args) {   
        Outer o = new Outer();   
        Outer.Inner i1 = o.new Inner();   
        Outer.Inner i2 = o.createInner();   
          
        System.out.println(i1.getOuterClassName());   
        System.out.println(i2.getInnerClassName());   
    }   
}   
  
//output:   
/*  
    class Outer 
    class Outer$Inner  
*/  
</pre>


<h2>.new</h2>

<p>　　内部类对象是不能直接创建的。必须先创建一个外部类对象，再由这个外部类对象来创建内部类对象。这样处理可能是为了体现内部类对象是依存外部类对象存在的，即内部类对象不能脱离外部类对象而存在。一个外部类对象可以创建多个内部类对象 (类似 Process 与 Thread 的关系)。创建方法有2种：</p>

<ul>
<li>OuterClassObj.new InnerClass()：即使用 .new 和内部类构造器，如上面代码中的：
  <pre class="prettyprint linenums">
  Outer.Inner i1 = o.new Inner(); </pre></li>
<li>OuterClassObj.InnerClassConstructorProxy()：即使用在外部类中定义的内部类构造器的代理方法，如上面代码中的：
  <pre class="prettyprint linenums">
  Outer.Inner i2 = o.createInner(); </pre></li>
</ul>


<p>上面2种方法其实是等价的。</p>

<p>　　这里注意，内部类的声明类型必须是 Outer.Inner，编译出的文件为 Outer$Inner.class。</p>

<hr />

<h2>.this　　</h2>

<p>　　其实可以把 this 当作 class 的一个 static field，就算不用内部类，也可以照样用 class.this 形式，如上面代码中的：</p>

<pre class="prettyprint linenums">
public String getInnerClassName() {   
    return Inner.this.getClass().toString(); // 'Inner' can be omitted here   
}  
</pre>


<p>　　不过鉴于内部类和外部类的特殊关系，内部类必须能够访问其创建者，所以在内部类中可以使用 Outer.this 来指向创建这个内部类对象的外部类对象。如：</p>

<pre class="prettyprint linenums">
public String getOuterClassName() {   
    return Outer.this.getClass().toString(); //'Outer' CANNOT be omitted here   
}  
</pre>


<p>　　总结一点，.this 与 class 连用 (class.this)，.new 与 reference 连用 (obj.new)。</p>

<hr />

<h2>对外部类的field和method的访问　　</h2>

<p>　　就如同我们在一般类的方法或是 constructor 中省略 this 一样，内部类的方法也是如此，只是内部类中省略的是 this (i.e. Inner.this) 和 Outer.this 这2个 this。所以 <strong>看上去</strong> 在内部类的方法中可以直接访问外部类的 field/method，而且无论是哪种访问权限的 field/method 都可以访问，其实是因为内部类方法中可以通过 Outer.this 链接到外部类，由外部类来访问外部类的 field/method，自然是可以不考虑访问权限了。</p>

<p>　　如果内部类和外部类有 <em><strong>同名</strong></em> 的 field/method，单纯使用 SameFieldName 或是 SameMethodName() <em><strong>会被优先识别为内部类的</strong></em> field/method，如果想要用外部类的 field/method，必须用 Outer.this 来指定。</p>

<p>　　如果你手中只有内部类对象，比如 i1、i2，这样是无法直接访问外部类的 field/method 的，因为外部类的 field/method 并不属于内部类，类似 i1.OuterField 或是 i2.OuterMethod() 是无法通过编译的。所以 i1、i2 想要访问外部类的 field/method 只能间接通过内部类的方法。</p>

<p>　　总之，简单的说，内部类对象要想访问外部类对象的 field 或是 method 的话，必须要先获得创建自己的外部类对象的引用。</p>

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/java/2009/04/05/anonymous-inner-class" title="匿名内部类 (anonymous inner class)：简化形式及自动向上转型">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/java/2009/04/05/local-inner-class" title="局部内部类 (local inner class)">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>05 April 2009</span></div>
	
  <br/>
	
  
    <h4>Categories</h4>
	<ul class="tag_box">
	
	


  
     
    	<li><a href="/categories.html#java-ref">
    		java <span>40</span>
    	</a></li>
    
  


	</ul>
    

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#Java-101-ref">Java-101 <span>49</span></a></li>
     
    	<li><a href="/tags.html#Java-InnerClass-ref">Java-InnerClass <span>6</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Erik Yao 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>



<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Erik Yao's 对内部类的继承</title>
    <meta name="description" content="">
    <meta name="author" content="Erik Yao">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/css/1.4.0/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
	<link href="/assets/themes/twitter/google-code-prettify/prettify.css" rel="stylesheet" type="text/css" media="all">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/prettify.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/use-prettify.js"></script>
  </head>

  <body>

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="/">Erik Yao's</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/index.html">Home</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>对内部类的继承 <small></small></h1>
</div>

<div class="row">
  <div class="span10">
    <p>　　首先我们明确下 enclose 这个单词的逻辑关系：OuterClass encloses InnerClass，所以外部类就是 enclosing class，内部类是 enclosed class。</p>

<hr />

<p>　　如果一个一般类来继承内部类，需要在构造器中使用特殊的语法。</p>

<pre class="prettyprint linenums">
class Outer {  
    class Inner {}  
}  
  
public class ExtInner extends Outer.Inner {  
    public ExtInner(Outer o) {  
        o.super();  
    }  
}  
</pre>


<p>　　ExtInner 的构造器必须要有一个 Outer 参数，然后调用 .super();。这里要求必须使用一个 <code>enclosingClassReference.super();</code>。</p>

<p>　　<em>题外话</em>：你可能会问：在 ExtInner 的构造器里 return o.new Inner(); 行不行？编译器会告诉你：constructor 的 return-type 是 void。这个是本话题的意外收获。</p>

<p>　　然后 ExtInner 中无法通过 Outer.this 来连接到外部类对象，在 ExtInner 中使用 Outer.this 会得到编译错误 “Outer 不是封闭类” (Java SE 1.5.0_15)，这里的封闭类应该就是 enclosing class 的意思，“Outer不是封闭类” 表示 Outer 并没有 enclose ExtInner，虽然 Outer 有 enclose Inner，且 ExtInner 继承自 Inner。</p>

<p>　　如果 Base 有一个 Inner，然后 Ext 继承了 Base，这时 Ext 并没有继承 Base.Inner 的代码，即 Base.Inner 的代码没有复制到 Ext 中。此时，如果在 Ext 中也写一个 Inner，其实是不会发生冲突的。</p>

<hr />

<p>　　如果内部类、外部类双重继承，情况如何呢？看下面代码：</p>

<pre class="prettyprint linenums">
class BaseOuter {  
    void print() {  
        System.out.println("BaseOuter prints");  
    }  
      
    class BaseInner {  
        void print2() {  
            System.out.println("BaseInner prints");  
        }  
          
        void print3() {  
            BaseOuter.this.print();  
        }  
    }  
}  
  
class ExtOuter extends BaseOuter {  
    void print4() {  
        System.out.println("ExtOuter prints");  
    }  
      
    class ExtInner extends BaseOuter.BaseInner {  
        void print5() {  
            System.out.println("ExtInner prints");  
        }  
          
        void print6() {  
            ExtOuter.this.print4();  
        }  
          
        void print7() {  
            BaseOuter.this.print(); // error: BaseOut is not the enclosing class  
        }  
    }  
}  
  
public class ExtInnerTest {  
    public static void main(String[] args) {  
        ExtOuter eo = new ExtOuter();  
        ExtOuter.ExtInner ei = eo.new ExtInner();  
          
        ei.print2();  
        ei.print3();  
        ei.print5();  
        ei.print6();  
        ei.print7(); // error: BaseOut is not the enclosing class  
    }  
}  
</pre>


<p>　　可以看到 ExtInner 可以通过向上转型变成 BaseInner，然后再连接到 BaseOut.this (ei.print3(); // OK)，但是不能直接使用 BaseOut.this (ei.print7(); // won't compile)。</p>

<p>　　总结一点，内部类不能被外部类的导出类继承，外部类也不 enclose 内部类的导出类。</p>

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/java/2009/04/05/static-inner-class" title="static inner class">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/java/2009/04/07/new-way-to-understand-extending" title="关于继承的新认识：导出类调用基类方法其实是向上转型">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>07 April 2009</span></div>
	
  <br/>
	
  
    <h4>Categories</h4>
	<ul class="tag_box">
	
	


  
     
    	<li><a href="/categories.html#java-ref">
    		java <span>40</span>
    	</a></li>
    
  


	</ul>
    

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#Java-101-ref">Java-101 <span>49</span></a></li>
     
    	<li><a href="/tags.html#Java-InnerClass-ref">Java-InnerClass <span>6</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Erik Yao 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>


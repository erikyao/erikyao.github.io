
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Erik Yao's Simple Form Handling Example</title>
    <meta name="description" content="">
    <meta name="author" content="Erik Yao">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/css/1.4.0/bootstrap.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
	<link href="/assets/themes/twitter/google-code-prettify/prettify.css" rel="stylesheet" type="text/css" media="all">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/prettify.js"></script>
	<script type="text/javascript" src="/assets/themes/twitter/google-code-prettify/use-prettify.js"></script>
  </head>

  <body>

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="/">Erik Yao's</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/index.html">Home</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Simple Form Handling Example <small></small></h1>
</div>

<div class="row">
  <div class="span10">
    <p>　　继续 <a href="/springmvc/2009/11/29/spring-mvc-example-anatomy/">Spring MVC example anatomy</a> 中springapp的例子。</p>

<p>　　PriceIncreaseController extends SimpleFormController。SimpleFormController 有2个视图：formView 用来显示 form，successView 则是 form 提交后转到的页面。</p>

<p>　　当我们从hello.htm(实际是hello.jsp)上点击priceincrease.htm的超链接时，实际是发送了一个GET方法的请求，然后处理流程如下：</p>

<p><img src="https://vgk9nq.bn1301.livefilestore.com/y2patK-yYFT1JWrgQxzD4EBfbRYeTdUTN3lNj55sUpUe47nOdHntmFbF0GGqBKGAeP5MG5IKK6LAXzZ5IOKf4p6rmiCIldN77eDe4rvJyyvq1o/1.png?psid=1" alt="" /></p>

<p>　　如果priceincrease.jsp页面上需要显示一些数据，可以通过formBackingObject()方法来初始化Command Object，这个接下来再讲。</p>

<p>　　一般使用 DI 来设置 SimpleFormController 的 formView 和 successView：</p>

<pre class="prettyprint linenums">
&lt;bean name="/priceincrease.htm" class="springapp.web.PriceIncreaseFormController"&gt;  
    &lt;property name="sessionForm" value="true" /&gt;  
    &lt;property name="commandName" value="priceIncrease" /&gt;  
    &lt;property name="commandClass" value="springapp.service.PriceIncrease" /&gt;  
    &lt;property name="validator"&gt;  
        &lt;bean class="springapp.service.PriceIncreaseValidator" /&gt;  
    &lt;/property&gt;  
    &lt;property name="formView" value="priceincrease" /&gt;  
    &lt;property name="successView" value="hello.htm" /&gt;  
    &lt;property name="productManager" ref="productManager" /&gt;  
&lt;/bean&gt;  
</pre>


<p>　　这里还有个有意思的事情：即使不配置formView，根据 <a href="http://docs.spring.io/spring/docs/2.5.6/reference/mvc.html#mvc-coc">惯例优先原则</a>，DispatchServlet 还是能找到 priceincrease 这个 viewName，然后去交给 InternalResourceViewResolver 解析 (如果配置了，应该是 SimpleFormController 执行 showForm 操作，返回一个 new ModelAndView(formView) 给 DispatchServlet)</p>

<p>　　我们注意到这里有 commandClass 和 commandName，这个还是相当于 jsp 页面的 Attribute。整个的提交的处理流程如下：</p>

<p><img src="https://vgk9nq.bn1303.livefilestore.com/y2pBqhXu3IfpA39w6tXqjjL7-yKmlBoA9tDfLaDeK0Quye8CDjRkVQujsDWy4CQPixDvI-511juiJgYCTac1M4qvqmK9rT4P0e3IbiIp1XrXEU/2.png?psid=1" alt="" /></p>

<p>　　这里需要注意的有以下几点：</p>

<ul>
<li>Command Object 不需要名字。commandName 并不是 Command Object 的名字，所以在 formBackingObject() 方法里面创建 Command Object 不需要特别注意名字。formBackingObject() 是一个覆写方法，父类中的方法应该也只是简单地 new 一个 Command Object</li>
<li>Command Object 的属性、JSP 中 &lt;form&gt; 标签中的 “path”、和 Validator 中的 reject 方法的参数存在对应关系，如下图所示 (文字描述太复杂了，画图算了)：</li>
</ul>


<p> <img src="https://vgk9nq.bn1.livefilestore.com/y2pG9gagUKiA4NcNi-gqmSLmgtmRJYYQEknWtsMBaswEMhp-ebqkcj8oaBenuhorSQGtTkku7y7pjFt7hGiqrNTCe9BaqgCtbFcMVu0dHEJW38/3.png?psid=1" alt="" /></p>

<ul>
<li>&lt;form:input path="percentage"&gt; 表示把这个文本框的输入内容写入 Command Object (已通过 commandName=“priceIncrease” 指定)；而 &lt;form:error path="percentage"&gt; 会被展开为成一个 &lt;span&gt; 来显示错误信息 (if any)，详见 <a href="http://docs.spring.io/spring/docs/2.5.0/reference/mvc.html#mvc-formtaglib-errorstag">The errors tag</a></li>
</ul>


    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/os/2009/12/05/pointer-swizzling" title="Pointer Swizzling">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/database/2009/12/25/isolation" title="Isolation">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>11 December 2009</span></div>
	
  <br/>
	
  
    <h4>Categories</h4>
	<ul class="tag_box">
	
	


  
     
    	<li><a href="/categories.html#springmvc-ref">
    		springmvc <span>2</span>
    	</a></li>
    
  


	</ul>
    

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#Config-ref">Config <span>11</span></a></li>
     
    	<li><a href="/tags.html#Config-SpringMVC-ref">Config-SpringMVC <span>2</span></a></li>
     
    	<li><a href="/tags.html#HowDoes-ref">HowDoes <span>5</span></a></li>
     
    	<li><a href="/tags.html#HowDoes-SpringMVC-ref">HowDoes-SpringMVC <span>2</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Erik Yao 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

